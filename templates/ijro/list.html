{% extends "base.html" %}
{% block content %}

<div class="page-title">
    <h1>Ijro topshiriqlari</h1>
</div>

<div class="ijro-actions">
    <a href="/ijro/calendar" class="btn btn-light">ðŸ“… Kalendar koâ€˜rinishi</a>
    {% if session.get("user_role") in ["admin","manager"] %}
        <a href="/ijro/create" class="btn btn-primary">+ Yangi topshiriq</a>
    {% endif %}
</div>

<div class="ijro-grid">
    {% for t in tasks %}
    <div class="ijro-card">
        <div class="ijro-header">
            <h3>{{ t.title }}</h3>
            <span class="badge {{ t.status }}">{{ t.status }}</span>
        </div>

        <div class="ijro-body">
            <p class="desc">{{ t.description }}</p>

            <div class="ijro-info">
                <div><b>Sana:</b> {{ t.date }}</div>
                <div><b>Muddat:</b> {{ t.due_date }}</div>
                <div><b>Kimga:</b> {{ t.assigned_to.username if t.assigned_to else "-" }}</div>
            </div>
        </div>

        <div class="ijro-footer">
            <a href="/ijro/details/{{ t.id }}" class="btn btn-small">Koâ€˜rish</a>

            {% if session.get("user_role") in ["admin","manager"] %}
            <a href="/ijro/edit/{{ t.id }}" class="btn btn-small btn-warning">Tahrirlash</a>
            {% endif %}

            {% if session.get("user_role") == "employee" %}
                {% if t.status != "done" %}
                    <a href="/ijro/done/{{ t.id }}" class="btn btn-small btn-success">Bajarildi âœ“</a>
                {% endif %}
            {% endif %}
        </div>

    </div>
    {% endfor %}
</div>

<style>
.page-title h1{
    font-size:28px;
    color:#fff;
    margin-bottom:20px;
}
.ijro-actions{
    display:flex;
    gap:12px;
    margin-bottom:20px;
}
.ijro-grid{
    display:grid;
    grid-template-columns:repeat(auto-fill,minmax(330px,1fr));
    gap:15px;
}
.ijro-card{
    background:#1c1f2b;
    padding:18px;
    border-radius:14px;
    border:1px solid #2e3448;
    transition:0.2s;
}
.ijro-card:hover{
    border-color:#4b6bff;
}
.ijro-header{
    display:flex;
    justify-content:space-between;
    align-items:center;
}
.badge{
    padding:4px 10px;
    border-radius:6px;
    font-size:12px;
    text-transform:uppercase;
}
.badge.new{background:#4b6bff;}
.badge.in_progress{background:#f7b500;}
.badge.done{background:#00c853;}
.badge.rejected{background:#ff5252;}

.desc{
    margin:10px 0;
    opacity:0.85;
}
.ijro-info div{
    margin-bottom:4px;
    font-size:13px;
}
.ijro-footer{
    margin-top:15px;
    display:flex;
    gap:10px;
}
.btn-small{
    padding:4px 10px;
}
</style>

{% endblock %}
