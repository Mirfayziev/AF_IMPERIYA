{% extends "base.html" %}
{% block header_title %}Rahbar paneli{% endblock %}

{% block content %}

<style>
/* PREMIUM MODERN LIGHT THEME, IMAGE-LIKE UI */

/* Top statistic cards */
.dashboard-stat-grid {
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    gap: 14px;
    margin-bottom: 22px;
}

.stat-card {
    background: #ffffff;
    padding: 16px 20px;
    border-radius: 14px;
    box-shadow: 0 4px 14px rgba(0,0,0,0.08);
    border: 1px solid #e5e7eb;
}
.stat-title {
    font-size: 14px;
    color: #6b7280;
    margin-bottom: 5px;
}
.stat-value {
    font-size: 26px;
    font-weight: 700;
    color: #111827;
}

/* Section Grid */
.section-2col {
    display: grid;
    grid-template-columns: 1.5fr 1.5fr;
    gap: 20px;
    margin-bottom: 20px;
}
.section-3col {
    display: grid;
    grid-template-columns: 1.2fr 1.2fr 1.5fr;
    gap: 20px;
}

/* Block Cards */
.block-card {
    background: #ffffff;
    border-radius: 18px;
    padding: 18px 20px;
    box-shadow: 0 8px 22px rgba(0,0,0,0.05);
    border: 1px solid #e6e6e6;
}
.block-title {
    font-size: 18px;
    font-weight: 700;
    margin-bottom: 12px;
    color: #111827;
}

/* Transport list */
.car-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 12px 0;
    border-bottom: 1px solid #e5e7eb;
}
.car-info {
    display: flex;
    align-items: center;
    gap: 12px;
}
.car-info img {
    width: 72px;
    height: 48px;
    object-fit: cover;
    border-radius: 10px;
    border: 1px solid #e5e7eb;
}
.car-data small {
    font-size: 12px;
    color: #6b7280;
}

/* Outsourcing table */
.table {
    width: 100%;
    border-collapse: collapse;
}
.table th, .table td {
    padding: 10px;
    border-bottom: 1px solid #e5e7eb;
    font-size: 14px;
    color: #374151;
}

/* Charts */
.chart-box {
    height: 260px;
}

</style>

<!-- ========================= -->
<!--       TOP STATISTICS      -->
<!-- ========================= -->

<div class="dashboard-stat-grid">

    <div class="stat-card">
        <div class="stat-title">Bajarilgan topshiriqlar</div>
        <div class="stat-value">{{ completed_tasks }}</div>
    </div>

    <div class="stat-card">
        <div class="stat-title">Jarayonda</div>
        <div class="stat-value">{{ in_progress }}</div>
    </div>

    <div class="stat-card">
        <div class="stat-title">Rad etilgan</div>
        <div class="stat-value">{{ rejected }}</div>
    </div>

    <div class="stat-card">
        <div class="stat-title">Kutilmoqda</div>
        <div class="stat-value">{{ pending }}</div>
    </div>

    <div class="stat-card">
        <div class="stat-title">Umumiy xodimlar</div>
        <div class="stat-value">{{ all_users }}</div>
    </div>

</div>


<!-- ========================= -->
<!--   MAIN 3-COLUMN SECTION   -->
<!-- ========================= -->

<div class="section-3col">

    <!-- === LEFT COLUMN === -->
    <div>

        <!-- Xodim topshiriqlari (NEW) -->
        <div class="block-card">
            <div class="block-title">Topshirqlar to‘plami</div>

            {% if latest_tasks %}
                {% for t in latest_tasks %}
                <div class="car-row">
                    <div>
                        <b>{{ t.title }}</b><br>
                        <small>{{ t.deadline }}</small>
                    </div>
                    <span style="font-size:13px;color:#4b6bff;">{{ t.status }}</span>
                </div>
                {% endfor %}
            {% else %}
                <p style="opacity:0.6;">Topshirqlar mavjud emas.</p>
            {% endif %}
        </div>

    </div>

    <!-- === MIDDLE COLUMN === -->
    <div>
        <div class="block-card">
            <div class="block-title">Avto transportlar</div>

            {% for v in vehicles %}
            <div class="car-row">
                <div class="car-info">
                    <img src="{{ url_for('static', filename='img/cars/' + v.image) }}">
                    <div class="car-data">
                        <b>{{ v.model }}</b><br>
                        <small>Yo‘l bosgan: {{ v.mileage }} km</small>
                    </div>
                </div>

                <div style="text-align:right;">
                    <div style="color:#10b981; font-weight:600;">{{ v.fuel_level }}%</div>
                    <small style="color:#ef4444;">{{ v.repair_days }} kun qoldi</small>
                </div>
            </div>
            {% endfor %}

        </div>
    </div>

    <!-- === RIGHT COLUMN (charts) === -->
    <div>

        <div class="block-card">
            <div class="block-title">Xodimlar faoliyati</div>
            <canvas id="employeeChart" class="chart-box"></canvas>
        </div>

        <br>

        <div class="block-card">
            <div class="block-title">So‘nggi 7 kun – Solar energiya</div>
            <canvas id="solarChart" class="chart-box"></canvas>
        </div>

    </div>

</div>


<!-- ========================= -->
<!--       OUTSOURCING        -->
<!-- ========================= -->

<div class="section-2col">

    <div class="block-card">
        <div class="block-title">Outsorsing xizmatlari</div>

        <table class="table">
            <tr>
                <th>Komapniya</th>
                <th>Xizmat turi</th>
                <th>Status</th>
            </tr>

            {% for o in outsourcing %}
            <tr>
                <td>{{ o.company }}</td>
                <td>{{ o.service_type }}</td>
                <td>{{ o.status }}</td>
            </tr>
            {% endfor %}
        </table>
    </div>

    <div class="block-card">
        <div class="block-title">Tashkilotlar ro‘yxati</div>

        {% for org in organizations %}
        <div class="car-row">
            <div>
                <b>{{ org.name }}</b><br>
                <small>Xodimlar: {{ org.employee_count }}</small>
            </div>
            <span style="font-size:13px;color:#4b6bff;">Batafsil →</span>
        </div>
        {% endfor %}
    </div>

</div>


<!-- ========= CHART JS ========= -->

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
/* EMPLOYEE BAR CHART */
new Chart(document.getElementById('employeeChart'), {
    type: 'bar',
    data: {
        labels: {{ employee_names | safe }},
        datasets: [{
            label: "Topshiriqlar",
            data: {{ employee_tasks | safe }},
            backgroundColor: "#4b6bff",
            borderRadius: 6
        }]
    },
    options: { responsive: true }
});

/* SOLAR LINE CHART */
new Chart(document.getElementById('solarChart'), {
    type: 'line',
    data: {
        labels: {{ solar_labels | safe }},
        datasets: [{
            label: "kWh",
            data: {{ solar_values | safe }},
            borderColor: "#22c55e",
            fill: false,
            tension: 0.4,
            borderWidth: 3
        }]
    },
    options: { responsive: true }
});
</script>

{% endblock %}
